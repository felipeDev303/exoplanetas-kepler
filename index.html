<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kepler Exoplanet</title>
    <link rel="stylesheet" href="/styles/ui.css" />
  </head>
  <body>
    <main class="exo-main">
      <h1>Kepler Exoplanet — Data processor</h1>
      <p>
        Abre la consola del navegador (F12) para ver la tabla de planetas
        procesados.
      </p>
      <p>
        Si no tienes <code>/data/exoplanets.json</code>, crea o guarda un
        archivo JSON con datos descargados.
      </p>
    </main>

    <section class="exo-panel">
      <div class="exo-row">
        <input
          id="exoSearch"
          class="exo-input"
          placeholder="buscar por nombre..."
        />
        <button id="btnSearch" class="exo-btn">Buscar</button>
      </div>
      <div class="exo-row">
        <button id="btnTop10" class="exo-btn">Top 10 por radio</button>
        <button id="btnStats" class="exo-btn">Resumen</button>
        <button id="btnVisualize" class="exo-btn">Visualizar 3D</button>
      </div>
      <pre id="exoOutput" class="exo-output">Cargando datos...</pre>
    </section>

    <script type="module" src="/scripts/processPlanets.js"></script>

    <script>
      // UI bindings - llaman a EXO_UTILS (expuesto por processPlanets.js)
      const out = document.getElementById("exoOutput");
      function show(o) {
        out.textContent =
          typeof o === "string" ? o : JSON.stringify(o, null, 2);
      }

      document.getElementById("btnSearch").addEventListener("click", () => {
        const q = document.getElementById("exoSearch").value.trim();
        if (!q) return show("Introduce un término de búsqueda");
        const res = window.EXO_UTILS?.searchByName(q) ?? [];
        show(res.slice(0, 50));
      });

      document.getElementById("btnTop10").addEventListener("click", () => {
        const res = window.EXO_UTILS?.topNByRadius(10) ?? [];
        show(res);
      });

      document.getElementById("btnStats").addEventListener("click", () => {
        const res = window.EXO_UTILS?.statsSummary() ?? {};
        show(res);
      });

      // Actualizar el panel cuando los datos estén listos
      const checkLoaded = setInterval(() => {
        if (window.EXO_PLANETS) {
          show(
            `${window.EXO_PLANETS.length} planetas cargados. Usa los botones para consultas.`
          );
          clearInterval(checkLoaded);
        }
      }, 200);

      // Visualizador 3D: carga dinámica del módulo y fallback
      document
        .getElementById("btnVisualize")
        .addEventListener("click", async () => {
          // Asegurar datos
          if (!window.EXO_PLANETS || !window.EXO_PLANETS.length) {
            const ok = confirm(
              "No hay datos cargados. ¿Generar datos de ejemplo?"
            );
            if (!ok) return;
            // crear datos de ejemplo simples
            window.EXO_PLANETS = Array.from({ length: 8 }).map((_, i) => ({
              name: `Mock ${i + 1}`,
              radius: Math.round((Math.random() * 10 + 0.5) * 10) / 10,
              period: Math.round((Math.random() * 300 + 10) * 10) / 10,
            }));
          }

          try {
            const m = await import("/scripts/visualizeThree.js");
            m.visualize();
          } catch (err) {
            console.error("Error cargando el visualizador:", err);
            alert("No se pudo cargar el visualizador. Revisa la consola.");
          }
        });
    </script>
  </body>
</html>
